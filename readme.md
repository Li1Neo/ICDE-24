# LAN

Code for paper "LAN: Learning Adaptive Neighbors for Real-Time ITD"

## Dataset Download

You can download dataset CERT r4.2 and r5.2 from  https://kilthub.cmu.edu/articles/dataset/Insider_Threat_Test_Dataset/12841247

## Dataset Preprocess

The code for data preprocessing is located in `dataprocess.py`.
The expected project structure is:

```
LAN
 |-- run.sh
 |-- run.py
 |-- inference.py
 |-- model.py
 |-- utils.py
 |-- dataprocess.py
 |-- data
 |    |-- output
 |    |-- r4.2
 |    |    |-- ...  
 |    |-- r5.2
 |    |    |-- ...      
 |    |-- answers
 |    |    |-- ...  
```

## How to run
(Recommend)You can run `run.sh` to train LAN.

You can also input the following command to train LAN. There are different choices for some parameters shown in square brackets. The meaning of these parameters are shown in the following tables.
| Parameters       | Value | Description                           |
| ---------------- | ----- | ------------------------------------- |
| epoch            | int   | Specify the total number of training epochs                      |
| classification_level            | str   | Set the classification level                       |
| device            | str   | Specify the computing device                        |
| batch_size            | int   | Specify the number of samples per batch                        |
| encoder_type            | str   | Specify the type of the model's sequence encoder, with options for LSTM, GRU, or Transformer                        |
| lr            | float   | Set the learning rate                  |
| srcroot            | str   | Specify the root path of the dataset                        |
| mixloss            | bool   | Enable hybrid prediction loss                        |
| graph_metric_type            | str   | Specify the type of similarity metric function for graph structure learning, with options for weighted cosine similarity or regular cosine similarity                        |
| OverSampling            | float   | Set the oversampling rate                        |
| add_graph_regularization            | bool   | Enable graph regularization loss                       |
| reduction            | str   | Specify the pooling function for aggregating the hidden states generated by the sequence encoder.                        |
| use_sample_weight            | bool   | Enable weighting for hard  negative feedback on the next activity prediction task                     |
| hard_negative_weight            | int   | Set the weight for hard negative feedback weighting                        |


python run.py \
--epoch YOUR_EPOCH \
--classification_level action \
--device cuda:0 \
--chunk_size YOUR_CHUNK_SIZE \
--batch_size YOUR_BATCH_SIZE \
--encoder_type [lstm, gru, transformer] \
--lr YOUR_LR \
--srcroot DATASET_PATH \
--mixloss \
--graph_metric_type [weighted_cosine, cosine] \
--OverSampling YOUR_OVERSAMPLINGRATE \
--add_graph_regularization \
--reduction lastpositionattention \
--use_sample_weight \
--hard_negative_weight YOUR_HARD_NEGATIVE_WEIGHT 

You can run inference.py for inference


**Performance of LAN with different numbers of candidate neighbors k obtained through retrievalï¼š**
CERT r4.2:
![r42](https://github.com/Li1Neo/ICDE-24/blob/main/topk42.pdf)
CERT r5.2:
![r52](https://github.com/Li1Neo/ICDE-24/blob/main/topk52.pdf)
